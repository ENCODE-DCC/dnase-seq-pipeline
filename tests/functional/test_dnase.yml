- name: test_dnase_replicate_pe
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    wdl/workflows/dnase_replicate.wdl \
    tests/functional/json/test_dnase_replicate_pe.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTTAATCTTAGTGTAGATCTCGGTGGTCGCCGTATCATT"
      - "AGATCGGAAGAGCACACGTCTGAACTCCAGTCACGAATTCGTATCTCGTATGCCGTCTTCTGCTTG"
      - "bwa aln"
      - "bwa sampe"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "CollectInsertSizeMetrics"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
      - " 540 "
      - " 534 "
      - " 214 "
      - " 34134 "
      - " 190 "
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
      md5sum: 742bd52cf3e4466d0bccf20a88dca34e
    - path: "test-output/nuclear.0.05.SPOT.txt"
      md5sum: 9e807bfdfc6a6b1c6f66da87dea307bc
    - path: "test-output/subsample.spot.out"
      md5sum: 9effecd50f29d0ca291781b2b57d5788
    - path: "test-output/trimstats.txt"
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: c56bef7c9b3866102d930cfff9610edd
    - path: "test-output/nuclear.preseq.txt"
      md5sum: 4c9817b5da6edd1d351634b81bbe1b71
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard"
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.info"
      md5sum: cfbb8aaa8ff9b5a8d264f23cde91d8ae
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.pdf"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
      md5sum: 713a0e019c00f72a68f8666b86763c69
    - path: "test-output/dispersion_model.json"

- name: test_dnase_replicate_pe_packed_references
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    wdl/workflows/dnase_replicate.wdl \
    tests/functional/json/test_dnase_replicate_pe_packed_references.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTTAATCTTAGTGTAGATCTCGGTGGTCGCCGTATCATT"
      - "AGATCGGAAGAGCACACGTCTGAACTCCAGTCACGAATTCGTATCTCGTATGCCGTCTTCTGCTTG"
      - "bwa aln"
      - "bwa sampe"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "CollectInsertSizeMetrics"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
      - " 540 "
      - " 534 "
      - " 214 "
      - " 34134 "
      - " 190 "
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
      md5sum: 742bd52cf3e4466d0bccf20a88dca34e
    - path: "test-output/nuclear.0.05.SPOT.txt"
      md5sum: 9e807bfdfc6a6b1c6f66da87dea307bc
    - path: "test-output/subsample.spot.out"
      md5sum: 9effecd50f29d0ca291781b2b57d5788
    - path: "test-output/trimstats.txt"
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: c56bef7c9b3866102d930cfff9610edd
    - path: "test-output/nuclear.preseq.txt"
      md5sum: 4c9817b5da6edd1d351634b81bbe1b71
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard"
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.info"
      md5sum: cfbb8aaa8ff9b5a8d264f23cde91d8ae
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.pdf"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
      md5sum: 713a0e019c00f72a68f8666b86763c69
    - path: "test-output/dispersion_model.json"

- name: test_dnase_replicate_se
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    wdl/workflows/dnase_replicate.wdl \
    tests/functional/json/test_dnase_replicate_se.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "bwa aln"
      - "bwa samse"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
      - " 459 "
      - " 0 "
      - " 447 "
      - " 270 "
      - " 43929 "
    must_not_contain:
       - "CollectInsertSizeMetrics"
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
      md5sum: d27be50ab3ca7228d3b325c76a682f49
    - path: "test-output/nuclear.0.05.SPOT.txt"
      md5sum: 9e1f19d6e61863f22c8abb4664b869e5
    - path: "test-output/subsample.spot.out"
      md5sum: 3e391a3651b48a9082ebde89c403c4ae
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: 74beb6691405cf90a4f78922d9a78ba6
    - path: "test-output/nuclear.preseq.txt"
      md5sum: bf07d3d3662edd7aeb37f9e4f7603920
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
    - path: "test-output/dispersion_model.json"

- name: test_dnase_replicate_mixed
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    wdl/workflows/dnase_replicate.wdl \
    tests/functional/json/test_dnase_replicate_mixed.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTTAATCTTAGTGTAGATCTCGGTGGTCGCCGTATCATT"
      - "AGATCGGAAGAGCACACGTCTGAACTCCAGTCACGAATTCGTATCTCGTATGCCGTCTTCTGCTTG"
      - "bwa aln"
      - "bwa sampe"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
      - " 693 "
      - " 0 "
      - " 667 "
      - " 386 "
      - " 61564 "
    must_not_contain:
      - "CollectInsertSizeMetrics"
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.SPOT.txt"
    - path: "test-output/subsample.spot.out"
    - path: "test-output/nuclear.preseq_targets.txt"
    - path: "test-output/nuclear.preseq.txt"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
    - path: "test-output/dispersion_model.json"

- name: test_base_dnase_se
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    dnase.wdl \
    tests/functional/json/test_base_dnase_se.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "bwa aln"
      - "bwa samse"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
    must_not_contain:
       - "CollectInsertSizeMetrics"
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
      md5sum: 742bd52cf3e4466d0bccf20a88dca34e
    - path: "test-output/nuclear.0.05.SPOT.txt"
      md5sum: 9e807bfdfc6a6b1c6f66da87dea307bc
    - path: "test-output/subsample.spot.out"
      md5sum: 9effecd50f29d0ca291781b2b57d5788
    - path: "test-output/trimstats.txt"
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: c56bef7c9b3866102d930cfff9610edd
    - path: "test-output/nuclear.preseq.txt"
      md5sum: 4c9817b5da6edd1d351634b81bbe1b71
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard"
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.info"
      md5sum: cfbb8aaa8ff9b5a8d264f23cde91d8ae
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.pdf"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
      md5sum: 713a0e019c00f72a68f8666b86763c69
    - path: "test-output/dispersion_model.json"

- name: test_base_dnase_mixed
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    dnase.wdl \
    tests/functional/json/test_base_dnase_mixed.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTTAATCTTAGTGTAGATCTCGGTGGTCGCCGTATCATT"
      - "AGATCGGAAGAGCACACGTCTGAACTCCAGTCACGAATTCGTATCTCGTATGCCGTCTTCTGCTTG"
      - "bwa aln"
      - "bwa sampe"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
    must_not_contain:
      - "CollectInsertSizeMetrics"
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.SPOT.txt"
    - path: "test-output/subsample.spot.out"
    - path: "test-output/nuclear.preseq_targets.txt"
    - path: "test-output/nuclear.preseq.txt"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
    - path: "test-output/dispersion_model.json"

- name: test_base_dnase_pe
  tags:
    - full
  command: >-
    tests/caper_run.sh \
    dnase.wdl \
    tests/functional/json/test_base_dnase_pe.json
  stdout:
    contains:
      - "cat"
      - "awk"
      - "AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTTAATCTTAGTGTAGATCTCGGTGGTCGCCGTATCATT"
      - "AGATCGGAAGAGCACACGTCTGAACTCCAGTCACGAATTCGTATCTCGTATGCCGTCTTCTGCTTG"
      - "bwa aln"
      - "bwa sampe"
      - "samtools sort"
      - "filter_reads.py"
      - "RevertOriginalBaseQualitiesAndAddMateCigar"
      - "MarkDuplicatesWithMateCigar"
      - "hotspot2.sh"
      - "random_sample_read1.sh"
      - "runhotspot.bash"
      - "starch_to_bigwig.bash"
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "CollectInsertSizeMetrics"
      - "preseq lc_extrap"
      - "pigz"
      - "bedToBigBed"
      - "ftd-learn-dispersion-model"
      - "ftd-compute-deviation"
      - "unstarch"
      - "--elements"
      - "wc"
      - "-l"
      - " 540 "
      - " 534 "
      - " 214 "
      - " 34134 "
      - " 190 "
  files:
    - path: "test-output/merged.bam"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.bam"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/normalized.nuclear.0.05.density.bw"
    - path: "test-output/nuclear.0.05.allcalls.bed.gz"
    - path: "test-output/nuclear.0.05.allcalls.bb"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.001.peaks.narrowpeaks.bb"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bed.gz"
    - path: "test-output/nuclear.0.05.peaks.narrowpeaks.bb"
      md5sum: 5bd3215f762e52fccea53bb0cc2aca72
    - path: "test-output/nuclear.0.05.SPOT.txt"
      md5sum: d5c0602308fc750da6630ea52ef8b058
    - path: "test-output/subsample.spot.out"
      md5sum: b86f89d7c2778558a336ed9112913d46
    - path: "test-output/trimstats.txt"
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: 1c2f55280daae80307bfda6e2d726712
    - path: "test-output/nuclear.preseq.txt"
      md5sum: 4bbc21653c28e21c1b09be846a57e5de
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard"
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.info"
      md5sum: 2787fe8fac4200725fb06f414bde8c84
    - path: "test-output/nuclear.CollectInsertSizeMetrics.picard.pdf"
    - path: "test-output/footprints.fps.0.01.bed.gz"
    - path: "test-output/footprints.fps.0.01.bb"
      md5sum: 16631a79f6a6c3f66faca1eee7962e41
    - path: "test-output/dispersion_model.json"

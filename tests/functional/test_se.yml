- name: test_se_concatenate
  tags:
    - functional
  command: >-
    tests/caper_run.sh \
    wdl/workflows/se/concatenate.wdl \
    tests/functional/json/test_se_concatenate.json
  stdout:
    contains:
      - "cat"
      - "concatenated.fastq.gz"
  files:
    - path: "test-output/concatenated.fastq.gz"
      md5sum: 52afaef92fadeabb19e9ee6c229882c0

- name: test_se_trim
  tags:
    - functional
  command: >-
    tests/caper_run.sh \
    wdl/workflows/se/trim.wdl \
    tests/functional/json/test_se_trim.json
  stdout:
    contains:
      - "pigz"
      - "awk"
  files:
    - path: "test-output/trimmed_to_length_trim.R1.fastq.gz"

- name: test_se_align
  tags:
    - functional
  command: >-
    tests/caper_run.sh \
    wdl/workflows/se/align.wdl \
    tests/functional/json/test_se_align.json
  stdout:
    contains:
      - "bwa aln"
      - "bwa samse"
      - "samtools sort"
      - "-n"
  files:
    - path: "test-output/name_sorted_se.bam"

- name: test_se_qc
  tags:
    - functional
  command: >-
    tests/caper_run.sh \
    wdl/workflows/se/qc.wdl \
    tests/functional/json/test_se_qc.json
  stdout:
    contains:
      - "bamcounts.py"
      - "samtools stats"
      - "samtools flagstats"
      - "preseq lc_extrap"
    must_not_contain:
      - "CollectInsertSizeMetrics"
  files:
    - path: "test-output/tagcounts.txt"
    - path: "test-output/merged.stats.txt"
    - path: "test-output/merged.flagstats.txt"
    - path: "test-output/nuclear.stats.txt"
    - path: "test-output/nuclear.flagstats.txt"
    - path: "test-output/tests/data/dnase/hotspot1/subsample.spot.out"
      md5sum: 09e71419a7c0023634359f3e6a30a155
    - path: "test-output/tests/data/dnase/hotspot2/expected/filtered.0.05.SPOT.txt"
      md5sum: d5c0602308fc750da6630ea52ef8b058
    - path: "test-output/tests/data/dnase/aggregation/expected/MarkDuplicates.picard"
    - path: "test-output/nuclear.preseq_targets.txt"
      md5sum: 1c2f55280daae80307bfda6e2d726712
    - path: "test-output/nuclear.preseq.txt"
      md5sum: 4bbc21653c28e21c1b09be846a57e5de

- name: test_build_fasta_index
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_build_fasta_index.wdl \
      tests/integration/json/test_build_fasta_index.json
  stdout:
    contains:
      - "samtools faidx chr22.fa"
  files:
      - path: "test-output/chr22.fa.fai"
        md5sum: d89b1fd70e1fe59b329a8346a59ffc03
      - path: "test-output/chr22.fa"
        md5sum: 69a750d5ed9490e0d1e707a43368ba86

- name: test_convert_sam_to_bam
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_convert_sam_to_bam.wdl \
      tests/integration/json/test_convert_sam_to_bam.json
  stdout:
    contains:
      - "samtools view"
      - "-b "
      - "-t "
      - "chr22.fa.fai"
      - "out.bam"
  files:
      - path: "test-output/out.bam"

- name: test_sort_bam_by_coordinate
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_sort_bam_by_coordinate.wdl \
      tests/integration/json/test_sort_bam_by_coordinate.json
  stdout:
    contains:
      - "samtools sort"
      - "-l 0"
      - "-@ 1"
      - "out.bam"
      - "sorted.bam"
    must_not_contain:
      - "-n"
  files:
      - path: "test-output/sorted.bam"

- name: test_sort_bam_by_name
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_sort_bam_by_name.wdl \
      tests/integration/json/test_sort_bam_by_name.json
  stdout:
    contains:
      - "samtools sort"
      - "-l 0"
      - "-n"
      - "-@ 1"
      - "out.bam"
      - "sorted.bam"
  files:
      - path: "test-output/sorted.bam"

- name: test_filter_bam_reads_with_qc_fail_flag
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_filter_bam_reads_with_qc_fail_flag.wdl \
      tests/integration/json/test_filter_bam_reads_with_qc_fail_flag.json
  stdout:
    contains:
      - "samtools view"
      - "-b"
      - "-F 512"
  files:
      - path: "test-output/qc_fail_flag_filtered.bam"

- name: test_filter_bam_reads_with_nonnuclear_flag
  tags:
    - integration
  command: >-
      tests/caper_run.sh \
      tests/integration/wdl/test_filter_bam_reads_with_nonnuclear_flag.wdl \
      tests/integration/json/test_filter_bam_reads_with_nonnuclear_flag.json
  stdout:
    contains:
      - "samtools view"
      - "-b"
      - "-F 4096"
  files:
      - path: "test-output/nuclear.bam"
